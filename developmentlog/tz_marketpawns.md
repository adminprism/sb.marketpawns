# Техническое Задание на разработку сайта Market Pawns

## 1. Введение

### 1.1. Цель проекта
Разработка веб-сайта для работы с финансовыми данными из базы данных market_pawns, предоставляющего инструменты для анализа и визуализации моделей рынка, создания и управления торговыми сетапами, а также расчета торговых метрик.

### 1.2. Назначение системы
Система предназначена для аналитиков финансовых рынков, трейдеров и разработчиков торговых стратегий, которым необходимы инструменты для работы с моделями, построенными на основе исторических данных рынка.

## 2. Архитектура системы

### 2.1. Общая архитектура
- Веб-приложение с клиент-серверной архитектурой
- Frontend: HTML5, CSS3, JavaScript (с использованием jQuery)
- Backend: PHP
- База данных: MySQL (market_pawns)

### 2.2. Конфигурация базы данных
```
$dbhost = 'localhost';
$dbname = 'market_pawns';
$dbuser = 'root';
$dbpass = 'Timer11!';
```

## 3. Структура базы данных

На основе анализа текущего проекта, необходимо реализовать следующие основные таблицы:

### 3.1. Основные таблицы

#### chart_names
Таблица содержит информацию о доступных инструментах и таймфреймах:
- id (PRIMARY KEY)
- name - название инструмента с таймфреймом (например, EURUSD60)
- tool - название инструмента (например, EURUSD)
- timeframe - таймфрейм в секундах
- filename - исходный файл с данными
- section - секция для распределения нагрузки

#### charts
Таблица с историческими данными графиков:
- id (PRIMARY KEY)
- name_id - ссылка на chart_names
- datetime - время свечи
- open, high, low, close - цены OHLC
- volume - объем
- bar_id - уникальный идентификатор бара

#### models
Центральная таблица, содержащая данные моделей:
- id (PRIMARY KEY)
- name_id - ссылка на chart_names
- bar_id - ссылка на конкретный бар
- alg - алгоритм (1 или 2)
- различные точки и параметры модели (t1, t2, t3, и т.д.)
- поля для параметров моделей

#### statuses
Таблица для хранения возможных статусов моделей:
- id (PRIMARY KEY)
- status - текст статуса

#### status_map
Таблица связей между моделями и статусами:
- model_id - ссылка на модель
- status_id - ссылка на статус

#### matches
Таблица совпадений между моделями:
- model_id - ID первой модели
- m1_G1 - группа первой модели
- type - тип совпадения
- aim_name - название цели
- link_id - ID второй (связанной) модели
- link_aim_name - название цели связанной модели
- tf1, tf2 - таймфреймы моделей
- X, Slvl, St, Range - показатели совпадения

#### scores
Таблица оценок для нейросетевых моделей:
- model_id - ссылка на модель
- aim_name - название цели
- nn_number - номер нейросети
- различные метрики (NNClst, NNClstPl, и т.д.)

#### nn_answers
Таблица ответов нейросетей:
- model_id - ссылка на модель
- aim_name - название цели
- nn_number - номер нейросети
- answer - вероятность

#### controls
Таблица контрольных параметров моделей:
- model_id - ссылка на модель
- различные контрольные параметры

### 3.2. Вспомогательные таблицы
- idprevs_map - связи с предыдущими моделями
- idinners_map - внутренние связи моделей
- temp - временная таблица для операций
- пользовательские таблицы для сохранения настроек и предпочтений

## 4. Функциональные требования

### 4.1. Аутентификация и авторизация
- Регистрация пользователей
- Вход в систему
- Управление ролями (администратор, аналитик, пользователь)
- Логирование активности пользователей (login_log)

### 4.2. Импорт и управление данными
- Загрузка файлов с историческими данными (CSV)
- Определение инструмента и таймфрейма на основе имени файла
- Преобразование данных в различные таймфреймы
- Расчет производных показателей

### 4.3. Построение и анализ моделей
- Построение моделей по алгоритму 1 (build_models_A1)
- Построение моделей по алгоритму 2 (build_models_A2)
- Поиск совпадений между моделями (calc_matches)
- Расчет нейросетевых показателей (calc_NN)
- Расчет торговых сетапов (calc_setups)
- Расчет контрольных параметров (calc_controls)

### 4.4. Визуализация
- Отображение графиков инструментов с различными таймфреймами
- Визуализация моделей на графиках
- Интерактивная настройка параметров отображения
- Адаптивный дизайн для мобильных устройств

### 4.5. Симуляция торговли
- Расчет торговых сигналов (calc_trade1)
- Эмуляция торговых стратегий
- Анализ результатов эмуляции

### 4.6. Экспорт данных
- Выгрузка результатов анализа в CSV
- Сохранение графиков и моделей

## 5. Нефункциональные требования

### 5.1. Производительность
- Оптимизация запросов к базе данных
- Кэширование часто используемых данных
- Асинхронная загрузка данных при необходимости

### 5.2. Безопасность
- Защита от SQL-инъекций
- Валидация входных данных
- Защита от XSS-атак
- Безопасное хранение паролей

### 5.3. Масштабируемость
- Возможность добавления новых инструментов и таймфреймов
- Расширение функциональности без переработки архитектуры

### 5.4. Отказоустойчивость
- Логирование ошибок
- Корректная обработка исключений

## 6. Интерфейс пользователя

### 6.1. Главная страница
- Заголовок и логотип
- Навигационное меню
- Область управления параметрами
- Основная область контента с графиками и моделями

### 6.2. Панель управления
- Выбор инструмента и таймфрейма
- Настройка параметров анализа
- Фильтры для отображения моделей

### 6.3. Страницы аналитики
- Таблицы с результатами анализа
- Графики с визуализацией моделей
- Инструменты для интерактивного взаимодействия

## 7. Интеграции и API

### 7.1. Внутренние API
- API для асинхронной загрузки данных (get_fragment.php)
- API для получения свечей (get_candles.php)
- API для расчетов моделей и метрик

### 7.2. Внешние интеграции (опционально)
- Интеграция с источниками данных
- Возможность экспорта в торговые платформы

## 8. Технические требования и ограничения

### 8.1. Требования к серверу
- PHP 8.4 или выше
- MySQL 5.7 или выше
- Apache/Nginx

### 8.2. Требования к клиенту
- Современные браузеры (Chrome, Firefox, Safari, Edge)
- JavaScript включен
- Адаптивность для различных устройств

### 8.3. Требования к безопасности
- Защита от основных типов веб-атак
- Разграничение прав доступа
- Безопасная передача данных

## 9. Этапы разработки и сроки

### 9.1. Этап 1: Проектирование
- Детализация архитектуры
- Проектирование базы данных
- Разработка прототипов интерфейса

### 9.2. Этап 2: Разработка ядра системы
- Реализация базовой структуры
- Работа с базой данных
- Аутентификация и авторизация

### 9.3. Этап 3: Разработка аналитического функционала
- Импорт данных
- Построение моделей
- Расчет метрик

### 9.4. Этап 4: Разработка пользовательского интерфейса
- Реализация визуальных компонентов
- Интерактивные элементы
- Адаптивный дизайн

### 9.5. Этап 5: Тестирование и оптимизация
- Функциональное тестирование
- Нагрузочное тестирование
- Оптимизация производительности

### 9.6. Этап 6: Внедрение
- Развертывание системы
- Обучение пользователей
- Техническая поддержка

## 10. Дополнительные требования

### 10.1. Документация
- Техническая документация
- Руководство пользователя
- Документация по API

### 10.2. Локализация
- Поддержка русского языка
- Возможность добавления других языков

### 10.3. Техническая поддержка
- Процедура обновления системы
- Резервное копирование данных
- Процедуры восстановления после сбоев 